
@{
    ViewBag.Title = "ListadoAplicacionLogTiempoReal";
    Layout = "~/Views/Shared/_LayoutBootstrap.cshtml";
}
@Html.Hidden("hdTipoArchivo", (object)ViewBag.TipoArchivo)
@Html.Hidden("hdCodigoEstructuraFuncional", (object)ViewBag.CodigoEstructuraFuncional)
<style>
    tbody td {
        padding: 30px;
    }

    tbody tr:nth-child(odd) {
        background-color: #EFEFEF;
        color: #000;
    }
</style>
<div class="uk-grid sigaf-titulo">
    <div class="uk-width-1-2">
        <h2 class="uk-margin-bottom">  Monitor - Log por aplicación</h2>
    </div>
</div>
<div class="md-card uk-margin-bottom uk-margin-small-top">
    <div class="md-card-content">
        <div id="divbody" class="uk-overflow-container">
            <div class="md-card-list-header md-card-list-header-combined heading_list" style="display: none">All Messages</div>
            <!--Contenido de la tabla-->
            <table class="uk-table uk-table-hover" style="margin-top:5px;" cellspacing="0" width="100%">

                <thead>
                    <tr class="row">
                        <th><span class="sub-heading">En tiempo real -><strong> @ViewBag.DescripcionEstructuraFuncional</strong> | <strong>@ViewBag.TipoArchivo</strong> </span></th>
                    </tr>
                </thead>
                <tbody id="body1">
                </tbody>
            </table>
        </div>
    </div>
</div>

@section scripts{
    <script src="~/Scripts/jquery.signalR-2.2.1.js"></script>
    <script src="~/Scripts/jquery.signalR-2.2.1.min.js"></script>
    <script src="~/signalr/hubs"></script>
    <script>
        $(document).ready(function () {
            $("tr:odd").css({
                "background-color": "#EFEFEF",
                "color": "#0000"
            });
        });

        $(function () {
            var logTable = $("#body1");
            var tipoArchivo = $("#hdTipoArchivo").val();
            var estructura = $("#hdCodigoEstructuraFuncional").val();
            var nlog = $.connection.auditoriaAplicacionHub;

            nlog.client.logEvent = function (datetime, logLevel, message) {
                var logLevelLower = logLevel.toLowerCase();
                $('#body1').prepend(" <tr><td >" + datetime + " :: <b>" + message + "</b></td></tr>");
            };

            $.connection.hub.start().done(function () {
                nlog.server.obtenerLog(escape(tipoArchivo), escape(estructura));
            });
        });
    </script>

   
}


