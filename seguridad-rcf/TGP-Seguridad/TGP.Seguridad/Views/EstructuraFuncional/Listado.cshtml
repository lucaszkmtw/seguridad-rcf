@using TGP.Seguridad.BussinessLogic.Dto
@model IEnumerable<EstructuraFuncionalDTO>
@{
    ViewBag.Title = "Seg - Listado de Estructuras Funcionales";
    Layout = "~/Views/Shared/_LayoutBootstrap.cshtml";
}


<div class="uk-grid sigaf-titulo">
    <div class="uk-width-large-1-2">
        <h2 class="uk-margin-bottom">Listado de Estructuras Funcionales</h2>
    </div>

        <div class="uk-width-large-1-2">
            <div class="uk-grid uk-grid-small uk-flex uk-flex-right" data-uk-grid-margin data-uk-grid-match="{target:'.md-btn-sigaf'}">
                <div id="divGenerarArchivo">
                    <a title="" onclick="showLoadingModal()" href="@Url.Action("Nuevo", "EstructuraFuncional")" class="md-btn md-btn-sigaf md-btn-accent md-fab-wave-light waves-effect waves-button waves-light">
                        <h2 class="heading_d uk-text-left md-color-white">
                            NUEVA
                            <span class="sub-heading md-color-white uk-text-upper">
                                Estructura
                            </span>
                        </h2>
                        <i class="icon-appSigaf material-icons">add_circle</i>
                    </a>
                </div>
            </div>
        </div>

</div>

<div class="md-card uk-margin-bottom">
    <div class="md-card-content">
        <table id="lista-estructuras" class="uk-table" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th>Código</th>
                    <th>Descripción</th>
                    <th>Bloqueado</th>
                    <th>Operación</th>
                </tr>
            </thead>
            <tbody>
                @foreach (EstructuraFuncionalDTO estructura in Model)
                {
                    <!-- un registro -->
                    <tr>
                        <td>@estructura.Codigo</td>
                        <td>@estructura.DescripcionEstructura</td>
                        <td>@((estructura.SiBloqueado)? "SI": "NO")</td>
                        <td>
                            <a class="acciones" data-original-title="Editar" data-toggle="tooltip" href="@Url.Action("Editar", "EstructuraFuncional", new {id = estructura.Id })">
                                <i class="material-icons ">mode_edit</i>
                            </a>
                            <a class="acciones" data-original-title="Eliminar" data-toggle="tooltip" href="#" onclick="eliminarEstructura('@estructura.DescripcionEstructura',@estructura.Id,@estructura.Version)">
                                <i class="material-icons ">delete</i>
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section scripts{
    <script>
        $(document).ready(function () {

            activarMenu('#Listado-EstructuraFuncional');


            $('#lista-estructuras').dataTable({
                "scrollX": true,
                iDisplayLength: 25,
                aaSorting: [[1, "asc"]],
                dom: "<'uk-grid' <'uk-width-large-1-2 countCheck'><'uk-width-large-1-2 uk-flex uk-flex-right'<'agregarNuevoDestBtn uk-margin-right'><'eliminarDestBtn'>>>" +
                "<'uk-grid uk-margin-small-bottom'<'uk-width-large-3-10'l><'uk-width-large-3-10 uk-padding-remove'f> <'uk-width-large-4-10 uk-padding-remove uk-flex uk-flex-right'B>>tirp",
                colVis: {
                    buttonText: '<i class="fa fa-eye" title="Mostrar / Ocultar"></i>',
                    restore: "Reestablecer",
                    showAll: "Mostrar Todas"
                },
                aoColumnDefs: [
                    { bSortable: false, aTargets: [3] },
                ],
                "lengthMenu": [[25, 50, 100, 300], [25, 50, 100, 300]],
                buttons: [
                    { extend: 'copy', className: 'md-btn md-btn-small', text: 'Copiar' },
                    { extend: 'csv', title: 'Listado de Estructuras Funcionales', className: 'md-btn md-btn-small' },
                    { extend: 'pdf', title: 'Listado de Estructuras Funcionales', className: 'md-btn md-btn-small', orientation: 'landscape', exportOptions: { columns: [0, 1, 2], }, customize: function (doc) { doc.defaultStyle.alignment = 'landscape'; } },
                    { extend: 'print', className: 'md-btn md-btn-small', text: 'Imprimir' }
                ],
                language: agregarLenguajeDatatable(),
            });



        });



        function eliminarEstructura(descripcion, id, version) {
            swal({
                title: "",
                text: "¿Desea eliminar la estructura " + descripcion +  "? ",
                icon: "warning",
                buttons: {
                    confirm: "Aceptar",
                    cancel: "Cancelar"
                },
                closeOnClickOutside: false
            }).then(
                (isConfirm) => {
                    if (isConfirm) {
                        $.ajax({
                            type: "POST",
                            url: '@Url.Action("Eliminar", "EstructuraFuncional")',
                            data: {
                                version: version,
                                id: id
                            },
                            beforeSend: function (xhr) {
                                showLoadingModal();
                            },
                            success: function (data) {
                                hideLoadingModal();
                                    swal({
                                        title: "",
                                        text: data.mensaje,
                                        icon: data.tipoMensaje,
                                        buttons: {
                                            confirm: "Aceptar"
                                        },
                                        closeOnClickOutside: false
                                    }).then(() => {
                                        window.location.reload();
                                    });
                             

                            }

                        });
                    }
                });
           
        }


    </script>


}